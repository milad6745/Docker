در Docker، **ساخت چند مرحله‌ای** (Multi-stage Build) روشی است برای ایجاد تصاویری کوچک‌تر و بهینه‌تر با استفاده از چند دستور `FROM` در یک Dockerfile. در هر مرحله می‌توانید از یک تصویر پایه متفاوت استفاده کنید و فقط فایل‌های مورد نیاز را از یک مرحله به مرحله دیگر منتقل کنید، که باعث کاهش اندازه نهایی تصویر و بهبود کارایی ساخت می‌شود.

### چرا از ساخت چند مرحله‌ای استفاده می‌شود؟

1. **تصاویر کوچکتر:** با جدا کردن وابستگی‌های ساخت از وابستگی‌های زمان اجرا، می‌توانید اطمینان حاصل کنید که فقط فایل‌های ضروری به تصویر نهایی منتقل شوند و اندازه آن کاهش یابد.
2. **Dockerfile تمیزتر:** ساخت چند مرحله‌ای به شما این امکان را می‌دهد که Dockerfile خود را تمیز نگه دارید و از مراحل غیرضروری اجتناب کنید.
3. **ساخت بهینه‌تر:** شما می‌توانید با استفاده از تصاویر مخصوص در مراحل مختلف، تصویر Docker بهینه‌تری برای کامپایل، ساخت و اجرای برنامه خود بسازید.

### نحوه عملکرد

در یک ساخت چند مرحله‌ای، چندین دستور `FROM` در یک Dockerfile وجود دارد. شما می‌توانید تصویر پایه را برای هر مرحله مشخص کنید و از دستور `COPY --from` برای کپی کردن فایل‌ها بین مراحل استفاده کنید.

### مثال از یک Dockerfile با ساخت چند مرحله‌ای

```dockerfile
# مرحله اول: مرحله ساخت
FROM golang:1.18 AS builder

WORKDIR /app
COPY . .
RUN go build -o myapp

# مرحله دوم: مرحله نهایی
FROM alpine:latest

WORKDIR /root/
COPY --from=builder /app/myapp .

CMD ["./myapp"]
```

در این مثال:

1. مرحله اول (با استفاده از تصویر `golang`) برای ساخت برنامه Go است.
2. مرحله دوم (با استفاده از تصویر `alpine`) فقط فایل‌های ضروری مانند برنامه کامپایل‌شده را از مرحله اول کپی می‌کند تا یک تصویر نهایی کوچک و بهینه ایجاد کند.

با این روش، شما می‌توانید اطمینان حاصل کنید که فقط فایل‌های ضروری در تصویر نهایی وجود دارند و حجم تصویر به حداقل می‌رسد.
